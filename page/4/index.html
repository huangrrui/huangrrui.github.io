<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com.cn","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="http://example.com.cn/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-Hans","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>黄瑞的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">黄瑞的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="黄瑞"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">黄瑞</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">88</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/04/25/%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E5%8A%A0%E8%BD%BD%E4%B8%A2%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/25/%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E5%8A%A0%E8%BD%BD%E4%B8%A2%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">分页列表加载丢失数据的问题分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-25 20:22:34 / Modified: 20:22:00" itemprop="dateCreated datePublished" datetime="2022-04-25T20:22:34+08:00">2022-04-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于分页列表的获取，如果存在多端操作，很有可能出现数据重复或者丢失的情况<br>这里以两张图作为说明<br><img src="/2022/04/25/%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E5%8A%A0%E8%BD%BD%E4%B8%A2%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/1.jpg"></p>
<p>这个是重复的情况，假如我们在获取第一页的数据后，后台新增了两条数据，那么原来处于第一页的”7“、”6“，两条数据就被划分到第二页了，我们接着请求第二页的时候，就会造成数据的重复（7、6又返回了给了前端），处理方式也比较简单，每条数据增加一个唯一Id，然后前端去重即可</p>
<p>第二种数据丢失的情况<br><img src="/2022/04/25/%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E5%8A%A0%E8%BD%BD%E4%B8%A2%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/2.jpg"></p>
<p>同样的，在我们请求完第一页的数据后，后台删掉了第一页中的”6“，就会造成原本在第二页里的”5“，变成了第一页，我们在拉取第二页数据的时候，就拿不到”5“了，造成了数据的丢失，这种情况，对于 http 网络请求来说，前端是没办法处理的，只能尽量规避。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/04/10/%E8%A7%86%E9%A2%91%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/10/%E8%A7%86%E9%A2%91%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">视频对比脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-10 20:19:08 / Modified: 20:19:00" itemprop="dateCreated datePublished" datetime="2022-04-10T20:19:08+08:00">2022-04-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>macOS Command Line Tool 截取视频中的某一帧的方法</p>
<pre><code class="swift">import Foundation
import AVFoundation

let url = URL(fileURLWithPath: &quot;/Users/huangrui/Desktop/1.mp4&quot;)
let asset = AVURLAsset(url: url)
let generator = AVAssetImageGenerator(asset: asset)
let duration: CMTime = asset.duration
let cgImage = try? generator.copyCGImage(at: CMTime(value: 1000, timescale: 1000), actualTime: nil)
let targetUrl = URL(fileURLWithPath: &quot;/Users/huangrui/Desktop/123.png&quot;)
let destination = CGImageDestinationCreateWithURL(targetUrl as CFURL, kUTTypePNG, 1, nil)
CGImageDestinationAddImage(destination!, cgImage!, nil)
let isSuccess = CGImageDestinationFinalize(destination!)
print(isSuccess)
</code></pre>
<p>CMTime 是个结构体，其中有两个属性需要关注，一个是 value，另一个是 timescale，他们的关系是</p>
<p>value&#x2F;timescale &#x3D; seconds</p>
<p>视频对比实现的方案比较简单，通过 AVAssetImageGenerator 截取两个视频相同时间点的画面，然后通过 OpenCV 获取到对应画面的像素点信息，使用均值哈希算法计算图片指纹进行比较，最后根据每一帧画面的比较结果，绘制出直方图输出（其中，横轴是时间，纵轴是相似率）。</p>
<p>均值哈希算法，它是感知哈希算法中最简单的一种，基本原理是对图片降频。对于图片，高频有很多细节，如颜色、亮度、透明度等等，而低频丢弃细节，只有图像结构，优点是计算简单，速度非常快。这里直接引用网址吧（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%9D%87%E5%80%BC%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/18839330">均值哈希</a>）</p>
<p>目前测试了三种情况。</p>
<p>第一种：自己与自己比较</p>
<p>输出结果：<br><img src="/2022/04/10/%E8%A7%86%E9%A2%91%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC/1.jpg"></p>
<p>完全一致</p>
<p>第二种：与仅互换了第二个第三个画面位置的视频比较</p>
<p>输出结果：<br><img src="/2022/04/10/%E8%A7%86%E9%A2%91%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC/2.jpg"></p>
<p>可以看到，前面有点不一样，后续是一样的，与预期相符</p>
<p>第三种，与仅修改了第三个画面的文案的视频进行对比</p>
<p>输出结果：<br><img src="/2022/04/10/%E8%A7%86%E9%A2%91%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC/3.jpg"></p>
<p>与预期相符。</p>
<p>同时可以使用OpenCV 中的VideoCapture对视频进行逐帧截图，这样就可以不局限于macOS平台了</p>
<p>目前脚本只是简单的对比视频每一帧是否相似，只能满足部分需求，假如遇到视频不对齐的情况，那么从不对齐的时间点开始，后续全部会判定为不相同，导致后续的结果输出不准确。</p>
<p>目前对每一帧的处理方式是：</p>
<ol>
<li>先转缩放至8x8</li>
<li>再传转成灰度</li>
<li>使用均值哈希生成图片指纹</li>
<li>计算两个指纹的汉明距离</li>
<li>设定一个阈值，假如两个图片指纹的汉明距离超过了这个阈值，则判定为不相符</li>
</ol>
<p>但是目前没有办法处理视频没有对齐的情况，后续可以针对这一点进行优化</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/03/28/flutter-%E5%9C%86%E8%A7%92%E8%BE%B9%E6%A1%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/28/flutter-%E5%9C%86%E8%A7%92%E8%BE%B9%E6%A1%86/" class="post-title-link" itemprop="url">flutter 圆角边框</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-03-28 20:10:08 / Modified: 20:10:00" itemprop="dateCreated datePublished" datetime="2022-03-28T20:10:08+08:00">2022-03-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天在视觉还原的时候遇到了一个问题，flutter 如何在裁剪的同时，设置一个贴合边缘的边框。</p>
<p>一开始想到的方案是使用 Container.decoration 属性来完成，通过提供一个设置了圆角和 BoxDecoration 对象来实现。</p>
<p>但是如果 Container.child 是一张图片，图片是不会被裁减的，所以需要换一种实现方式，效果对比如下<br><img src="/2022/03/28/flutter-%E5%9C%86%E8%A7%92%E8%BE%B9%E6%A1%86/1.jpg"></p>
<p>代码如下</p>
<pre><code class="dart">Container(
  foregroundDecoration: BoxDecoration(
    border: Border.all(color: Colors.red, width: 2),
    borderRadius: BorderRadius.circular(16),
  ),
  child: ClipRRect(
    borderRadius: BorderRadius.circular(16),
    child: _image(),
  ),
)
</code></pre>
<p>通过 foregroundDecoration 来设置圆角边框，通过 ClipRRect 来裁剪圆角图片，即可实现该效果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/03/21/AS%E8%BF%90%E8%A1%8Cflutter-App-%E6%89%BE%E4%B8%8D%E5%88%B0-Cocoapods-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/21/AS%E8%BF%90%E8%A1%8Cflutter-App-%E6%89%BE%E4%B8%8D%E5%88%B0-Cocoapods-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">AS运行flutter App 找不到 Cocoapods 的解决方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-03-21 19:15:06 / Modified: 19:15:00" itemprop="dateCreated datePublished" datetime="2022-03-21T19:15:06+08:00">2022-03-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天遇到了使用 AS 运行 flutter app 时，会爆出找不到 cocoapods 的问题，尝试过重新安装 Android studio 的方式，仍然未解决。</p>
<p>解决方案是在终端中，使用 open 命令打开 AS 即可，判断是 AS 中的环境变量与系统终端中的环境变量不一致导致找不到 cocoapods 导致的问题</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/03/11/%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/11/%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">编译报错解决方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-03-11 20:10:48 / Modified: 20:10:00" itemprop="dateCreated datePublished" datetime="2022-03-11T20:10:48+08:00">2022-03-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>当我们对 App 进行打包时，如果出现了如下错误<br><img src="/2022/03/11/%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/1.jpg"></p>
<p>或者类似的 One of the two will be used … 可以尝试各个依赖库的部署版本以及 Podfile 中指定的版本是否一致，修改为同一版本后可以修复该问题</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/02/22/%E4%B8%8A%E4%BC%A0%E4%BC%98%E5%8C%96-%E4%BB%BB%E5%8A%A1%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/22/%E4%B8%8A%E4%BC%A0%E4%BC%98%E5%8C%96-%E4%BB%BB%E5%8A%A1%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">上传优化&任务加载优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-02-22 20:08:53 / Modified: 20:08:00" itemprop="dateCreated datePublished" datetime="2022-02-22T20:08:53+08:00">2022-02-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>对于上传及加载本身，移动端这边可以做的并不是很多，主要的策略还是空间换时间，这个和谷歌的 Chrome 浏览器有点相似，后者是用内存换取性能上的优势。</p>
<p>所以，目前这两点优化的核心就是做缓存，以及如何高效地利用缓存。我们都是贪婪的，既想着，我需要的东西，缓存任何时候都能准确提供；又想要缓存中的内容一旦失效，可以立刻被清除出去，不占用多余的空间，但显然这个是不容易做到的。</p>
<p>在开始做缓存功能之前，我们先要解决几个问题：</p>
<p>首先，我们需要缓存等待上传的文件</p>
<p>第二个问题则有点棘手，VIP 用户最多可以上传 100 张素材，假如其中有几个视频，那一个任务中的素材，可能会达到好几个 G，多来几个这样的任务，十个 G 就没了，所以接下来的两个问题很重要</p>
<ol>
<li>什么时候缓存</li>
<li>什么时候清除缓存</li>
<li>第一个很好回答，用户点击保存或者制作的时候进行缓存就可以，下次用户进入这个任务时，可以直接读取缓存中的文件进行展示。</li>
</ol>
<p>第二个问题稍微有点复杂，正常流程下，任务的素材上传成功后就可以清除了，但同时也需要考虑失败或者别的情况，例如用户删除了任务，用户取消上传后又重新对任务进行了编辑的情况。</p>
<p>本次迭代主要是方案的确定，这样可以留出更多的时间让我们完善这个方案，尽可能的考虑多种情况，以及各个情况下的处理方式，这样写出来的程序就比较健壮，不容易出错。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/01/25/iPhone%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8%E4%B8%8E%E7%8A%B6%E6%80%81%E6%A0%8F%E9%AB%98%E5%BA%A6%E9%80%9F%E6%9F%A5%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/25/iPhone%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8%E4%B8%8E%E7%8A%B6%E6%80%81%E6%A0%8F%E9%AB%98%E5%BA%A6%E9%80%9F%E6%9F%A5%E8%A1%A8/" class="post-title-link" itemprop="url">iPhone屏幕尺寸与状态栏高度速查表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-25 19:57:59 / Modified: 19:57:00" itemprop="dateCreated datePublished" datetime="2022-01-25T19:57:59+08:00">2022-01-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <table>
<thead>
<tr>
<th align="center">屏幕尺寸</th>
<th align="center">状态栏高度</th>
</tr>
</thead>
<tbody><tr>
<td align="center">375x667</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">414x736</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">414x896</td>
<td align="center">44</td>
</tr>
<tr>
<td align="center">390x844</td>
<td align="center">47</td>
</tr>
<tr>
<td align="center">428x926</td>
<td align="center">47</td>
</tr>
<tr>
<td align="center">375x812</td>
<td align="center">50</td>
</tr>
<tr>
<td align="center">320x568</td>
<td align="center">20</td>
</tr>
</tbody></table>
<p>发现全面屏 iPhone 的状态栏高度居然是不相同的</p>
<p>假如隐藏了状态栏，通过 UIApplication.shared.statusBarFrame.height api 获取到的状态栏高度为 0，这在开发中需要注意一下</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/" class="post-title-link" itemprop="url">记一次有趣的debug经历</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-07 19:51:04 / Modified: 19:51:00" itemprop="dateCreated datePublished" datetime="2022-01-07T19:51:04+08:00">2022-01-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>项目出现了一个 bug，飞行模式下，弹出加载框后，App 就没办法响应用户的点击事件了，如果是有网络的状态，却没有这个问题。</p>
<p>我们使用的 Loading 库是 EasyLoading。</p>
<p>刚开始的思路是，既然开启飞行模式有问题，不开就正常了，那么应该是出现网络状态处理那里，检查了这一部分代码后仍然没有发现什么问题，Loading 是我们手动控制的，网络状态和它无关。</p>
<p>接着怀疑 Loading 控件本身是否进行了网络状态监听，查看代码后也没发现相关功能。</p>
<p>最后怀疑是否是 Loading 本身阻止了用户的手势。</p>
<p>在 flutter 中想展示一个透明控件有两种方式</p>
<pre><code class="dart">// 1. 设置背景色为透明颜色
Container(color: Colors.transparent);
// 2. 不设置背景色
Container();
</code></pre>
<p>这两种方式都会生成一个透明的控件，但是他们的区别是，第一个控件的透明部分会拦截用户手势，第二个控件的透明部分则不会拦截。</p>
<p>接着去检查 EasyLoading 的相关代码，发现了如下代码<br><img src="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/1.jpg"></p>
<p>简单说明下，它由两个 AnimatedBuilder 组成，上面那个生成背景控件，下面那个生成 Loading 控件，</p>
<p>对属性作下说明</p>
<ul>
<li>_ignoring 作为总开关 - false：如果可以的话，背景控件会响应用户手势；true：背景控件不会响应用户手势</li>
<li>_dismissOnTap - true：点击背景可以使 Loading 消失；false：点击背景不会使 Loading 消失。</li>
</ul>
<p>观察开启与关闭飞行模式时，这两个参数的值</p>
<p>关闭飞行模式（网络正常）</p>
<p>_ignoring &#x3D; true, _dismissOnTap &#x3D; false</p>
<p>开启飞行模式（无网络）</p>
<p>_ignoring &#x3D; false, _dismissOnTap &#x3D; false</p>
<p>开启飞行模式的时候 ignoring 变成了 false，所以 Loading 拦截了用户手势，这一块不正常，不应该变成 false，检查了相关的代码<br><img src="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/2.jpg"><br><img src="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/3.jpg"></p>
<p>简单说明下</p>
<ol>
<li>可以先忽略 ignoring 方法的第一行赋值语句。</li>
<li>maskType 由于没有指定，所以是默认的 .none。</li>
<li>由于最终却返回了 true，那么肯定是因为 EasyLoading.instance.userInteractions &#x3D; true 导致的。</li>
</ol>
<p>现在就得找问题的源头了，为啥飞行模式它是 true，突然想到，在飞行模式状态下开启 App，会在首页提示用户，“当前网络不佳”，查看代码后发现了这个<br><img src="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/4.jpg"></p>
<p>问题找到了，罪魁祸首就是它，由于 EasyLoading.instance 是个单例，所以这样会影响贯穿整个 App，是不正确的，会影响到其他地方的 Loading，应该使用它暴露出来的 API 才对，改成这样后 bug 消失。<br><img src="/2022/01/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84debug%E7%BB%8F%E5%8E%86/5.jpg"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2021/12/28/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/28/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84bug/" class="post-title-link" itemprop="url">日期格式化字符串与一个有趣的bug</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-28 20:56:37 / Modified: 20:56:00" itemprop="dateCreated datePublished" datetime="2021-12-28T20:56:37+08:00">2021-12-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天遇到一个神奇的问题<br><img src="/2021/12/28/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84bug/1.jpg"><br>猜猜他们输出是啥<br><img src="/2021/12/28/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84bug/2.jpg"><br>怎么到 2022 年去了，我明明使用的 Date() 对象（也就是代表了今天的日期）</p>
<p><strong>问题原因</strong></p>
<p>为什么 YYYY-MM-dd 格式化 2021 年 12 月 28 日的时候，会到 2022 年呢？</p>
<p>因为 YYYY 是 week-based-year，表示：当天所在的周属于的年份，一周从周日开始，周六结束，只要本周跨年，那么这周就算入下一年。</p>
<p>所以 2021 年 12 月 28 日那天在这种表述方式下就已经到 2022 年了。<br>而当使用 yyyy 的时候，就还是 2021 年。</p>
<p>这个问题告诉我们，大小写还是十分重要的。</p>
<p>日期格式化字符串有趣的用法</p>
<p>这里以一个表格为例，时间为 2021-12-30 23:05:00</p>
<p>代码如下</p>
<pre><code class="swift">let fmt = DateFormatter()
fmt.locale = Locale(identifier: &quot;zh-CN&quot;)
fmt.dateFormat = “some value&quot;
print(fmt.string(from:Date()))
</code></pre>
<p>some value 与 输出对照表</p>
<table>
<thead>
<tr>
<th align="center">some value</th>
<th align="center">输出</th>
</tr>
</thead>
<tbody><tr>
<td align="center">GGG</td>
<td align="center">公元 or 公元前</td>
</tr>
<tr>
<td align="center">EEE</td>
<td align="center">周四</td>
</tr>
<tr>
<td align="center">qqqq</td>
<td align="center">第四季度</td>
</tr>
<tr>
<td align="center">M</td>
<td align="center">12</td>
</tr>
<tr>
<td align="center">MM</td>
<td align="center">12</td>
</tr>
<tr>
<td align="center">MMM</td>
<td align="center">12月</td>
</tr>
<tr>
<td align="center">MMMM</td>
<td align="center">十二月</td>
</tr>
<tr>
<td align="center">w</td>
<td align="center">52（本周是今年的第几周）</td>
</tr>
<tr>
<td align="center">W</td>
<td align="center">4（本周是本月的第几周）</td>
</tr>
<tr>
<td align="center">d or dd</td>
<td align="center">30</td>
</tr>
<tr>
<td align="center">D or DD or DDD</td>
<td align="center">364（今天是今年的第几天）</td>
</tr>
<tr>
<td align="center">F</td>
<td align="center">5（今天所在的周是本月的第几周）</td>
</tr>
<tr>
<td align="center">e</td>
<td align="center">5（今天是本周的第几天，周日为第一天）</td>
</tr>
<tr>
<td align="center">a</td>
<td align="center">下午（上午 or 下午）</td>
</tr>
<tr>
<td align="center">h</td>
<td align="center">11（12小时制，范围为1-12）</td>
</tr>
<tr>
<td align="center">H</td>
<td align="center">23（24小时制，范围为0-23）</td>
</tr>
<tr>
<td align="center">k</td>
<td align="center">23（24小时制，范围是1-24）</td>
</tr>
<tr>
<td align="center">K</td>
<td align="center">11（12小时制，范围是0-11）</td>
</tr>
<tr>
<td align="center">m or mm</td>
<td align="center">5 or 05 （分钟）</td>
</tr>
<tr>
<td align="center">s</td>
<td align="center">秒</td>
</tr>
<tr>
<td align="center">S</td>
<td align="center">毫秒</td>
</tr>
<tr>
<td align="center">A</td>
<td align="center">83281917（当天的毫秒级时间戳）</td>
</tr>
</tbody></table>
<p>还有更多的用法，可以查看这个地方</p>
<p><a target="_blank" rel="noopener" href="http://www.unicode.org/reports/tr35/tr35-31/tr35-dates.html#Date_Format_Patterns">http://www.unicode.org/reports/tr35/tr35-31/tr35-dates.html#Date_Format_Patterns</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com.cn/2021/11/23/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD%E7%A5%9E%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="黄瑞">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄瑞的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 黄瑞的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/23/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD%E7%A5%9E%E5%99%A8/" class="post-title-link" itemprop="url">视频下载神器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-11-23 12:55:51 / Modified: 12:55:00" itemprop="dateCreated datePublished" datetime="2021-11-23T12:55:51+08:00">2021-11-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>想看视频却找不到下载链接？用它就够了，一个非常简洁，但是功能十分强大的网络视频下载器</p>
<p><a target="_blank" rel="noopener" href="https://github.com/soimort/you-get">https://github.com/soimort/you-get</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黄瑞</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
